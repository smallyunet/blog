<!DOCTYPE html><html lang="zh-cn"><head><title>Solana æ™ºèƒ½åˆçº¦å¼€å‘æ•™ç¨‹</title><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="stylesheet" href="/css/highlight/xcode.min.css"><link rel="stylesheet" href="/css/bootstrap/bootstrap-tooltips.css"><link rel="stylesheet" href="/css/post.css"><script src="/js/jquery.min.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="smallyuçš„åšå®¢" type="application/atom+xml">
</head><body><script>if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)) {
  document.body.classList.add('mobile')
  var navbar = document.querySelector('nav.navbar');
  if (navbar) {
    navbar.classList.remove('navbar-fixed-top');
  }
}
</script><div><div class="inner"><h1>Solana æ™ºèƒ½åˆçº¦å¼€å‘æ•™ç¨‹</h1><div class="time">2025-06-24</div><div class="title-margin"></div><p>è¿™ä¸ªä¸€ä¸ªé›¶åŸºç¡€çš„ç³»åˆ—æ•™ç¨‹ï¼Œå¯ä»¥ä»æœ€åŸºæœ¬çš„æ“ä½œå¼€å§‹å­¦ä¼š Solana æ™ºèƒ½åˆçº¦çš„å¼€å‘ã€‚ä¸€å…± 3 ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><a href="#%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B-1">ç¬¬ä¸€éƒ¨åˆ†</a>ï¼šåŸºç¡€ç¯å¢ƒå®‰è£…ã€HelloWorld åˆçº¦éƒ¨ç½²ã€é“¾ä¸Šåˆçº¦è°ƒç”¨</li>
<li><a href="#%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B-2">ç¬¬äºŒéƒ¨åˆ†</a>ï¼šå®ç° USDT åˆçº¦çš„æœ€å°æ¨¡å‹ï¼Œè‡ªå®šä¹‰æ•°æ®ç»“æ„ä¸æ–¹æ³•</li>
<li><a href="#%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B-3">ç¬¬ä¸‰éƒ¨åˆ†</a>ï¼šä½¿ç”¨å®˜æ–¹ SPL åº“å¤ç”¨åˆçº¦åŠŸèƒ½ï¼Œå®Œæˆæ ‡å‡†åŒ–ä»£å¸çš„å‘è¡Œ</li>
</ul>
<br>

<h2 id="å¼€å‘æ•™ç¨‹-1"><a href="#å¼€å‘æ•™ç¨‹-1" class="headerlink" title="å¼€å‘æ•™ç¨‹-1"></a>å¼€å‘æ•™ç¨‹-1</h2><p>æˆ‘ä»¬å°†ä»æœ€åŸºç¡€çš„æ“ä½œå¼€å§‹ï¼Œå­¦ä¹  Solana æ™ºèƒ½åˆçº¦çš„å¼€å‘ã€‚ä½ åªéœ€è¦æ™®é€šçš„ç¼–ç¨‹åŸºç¡€ï¼Œç†è§£é¢å‘å¯¹è±¡ç­‰æ¦‚å¿µå°±å¯ä»¥ï¼Œä¸éœ€è¦äº‹å…ˆçŸ¥é“å…¶ä»–ç½‘ç»œçš„æ™ºèƒ½åˆçº¦æ¦‚å¿µï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ Rust è¯­è¨€çš„ç¼–ç¨‹ç†å¿µã€‚</p>
<h3 id="1-å®‰è£…ç¯å¢ƒ"><a href="#1-å®‰è£…ç¯å¢ƒ" class="headerlink" title="1. å®‰è£…ç¯å¢ƒ"></a>1. å®‰è£…ç¯å¢ƒ</h3><p>è®¿é—® Solana å®˜æ–¹æä¾›çš„å®‰è£…æ•™ç¨‹ï¼š<a href="https://solana.com/docs/intro/installation">https://solana.com/docs/intro/installation</a></p>
<p>æ–‡æ¡£ä¸­æä¾›äº†ä¸€é”®å®‰è£…å…¨éƒ¨ä¾èµ–çš„å•ä¸ªå‘½ä»¤è¡Œï¼Œä¹Ÿæœ‰åˆ†é˜¶æ®µå®‰è£…çš„è¯¦ç»†æ•™ç¨‹ã€‚è¦æ³¨æ„å…¶ä¸­ Solana Cli æ˜¯éœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡æ–‡ä»¶çš„ã€‚å®‰è£…å¥½ä¸€åˆ‡åï¼Œ<code>solana</code> å‘½ä»¤åº”è¯¥æ˜¯å¯ç”¨çš„ï¼š</p>
<pre><code class="bash">solana --help
</code></pre>
<h3 id="2-åˆå§‹åŒ–é¡¹ç›®"><a href="#2-åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="2. åˆå§‹åŒ–é¡¹ç›®"></a>2. åˆå§‹åŒ–é¡¹ç›®</h3><p>ä½¿ç”¨ anchor å‘½ä»¤æ¥åˆå§‹åŒ–ä¸€ä¸ªæ™ºèƒ½åˆçº¦çš„é¡¹ç›®ï¼Œè¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·åœ¨ä¸Šä¸ªæ­¥éª¤å·²ç»å®‰è£…å¥½äº†ï¼Œå¯ä»¥å…ˆä¸ç”¨ç®¡ç”Ÿæˆçš„ç›®å½•ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­ï¼š</p>
<pre><code class="bash">anchor init hello_sol
cd hello_sol
</code></pre>
<h3 id="3-å†™å…¥åˆçº¦ä»£ç "><a href="#3-å†™å…¥åˆçº¦ä»£ç " class="headerlink" title="3. å†™å…¥åˆçº¦ä»£ç "></a>3. å†™å…¥åˆçº¦ä»£ç </h3><p><code>programs/hello_sol/src</code> ç›®å½•ä¸‹æœ‰ä¸€ä¸ª <code>lib.rs</code> æ–‡ä»¶ï¼Œ<code>.rs</code> ç»“å°¾æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ª Rust è¯­è¨€çš„ä»£ç æ–‡ä»¶ã€‚æŠŠè¿™äº›ä»£ç å¤åˆ¶è¿›å»ï¼Œæ³¨æ„ <code>declare_id</code> ä¸­çš„å†…å®¹æ˜¯ä½ çš„é¡¹ç›®åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆï¼Œä¸éœ€è¦åŸå°ä¸åŠ¨å¤åˆ¶ä¸‹é¢çš„å†…å®¹ï¼š</p>
<pre><code class="rust">use anchor_lang::prelude::*;

declare_id!(&quot;3Zbdw1oWu1CiMiQr3moQeT4XzMgeqmCvjH5R5wroDWQH&quot;);

#[program]
pub mod hello_sol &#123;
    use super::*;

    pub fn say_hello(ctx: Context&lt;Hello&gt;) -&gt; Result&lt;()&gt; &#123;
        msg!(&quot;Hello, world!&quot;);
        Ok(())
    &#125;
&#125;

#[derive(Accounts)]
pub struct Hello &#123;&#125;
</code></pre>
<h3 id="4-ç¼–è¯‘æ™ºèƒ½åˆçº¦"><a href="#4-ç¼–è¯‘æ™ºèƒ½åˆçº¦" class="headerlink" title="4. ç¼–è¯‘æ™ºèƒ½åˆçº¦"></a>4. ç¼–è¯‘æ™ºèƒ½åˆçº¦</h3><p>ä½¿ç”¨ anchor å‘½ä»¤ç¼–è¯‘ä½ åˆšæ‰å¤åˆ¶è¿›å»çš„æ™ºèƒ½åˆçº¦ä»£ç ï¼Œç¡®ä¿ç¼–è¯‘æ˜¯æˆåŠŸçš„ï¼Œä»£ç æ²¡æœ‰å†™é”™ã€‚ç¼–è¯‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›è­¦å‘Šï¼Œé‚£äº›è­¦å‘Šä¸è¦ç´§ï¼Œå› ä¸º Rust è¯­è¨€å¯¹äºä»£ç éå¸¸ä¸¥æ ¼ï¼Œå¾ˆå°çš„é—®é¢˜éƒ½ä¼šæŠ›å‡ºå¤§æ®µçš„è­¦å‘Šã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå‘½ä»¤è¡Œçš„è¾“å‡ºä¸ä¼šæœ‰é”™è¯¯æ—¥å¿—ï¼š</p>
<pre><code class="bash">anchor build
</code></pre>
<h3 id="5-è®¾ç½®æœ¬åœ°é»˜è®¤ç½‘ç»œ"><a href="#5-è®¾ç½®æœ¬åœ°é»˜è®¤ç½‘ç»œ" class="headerlink" title="5. è®¾ç½®æœ¬åœ°é»˜è®¤ç½‘ç»œ"></a>5. è®¾ç½®æœ¬åœ°é»˜è®¤ç½‘ç»œ</h3><p>è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œè®©ä½ æœ¬åœ°çš„ solana å‘½ä»¤é»˜è®¤ä½¿ç”¨ devnetï¼Œå› ä¸º devnet æ˜¯ç»™å¼€å‘è€…ä½¿ç”¨çš„ï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•è‡ªå·±çš„ç¨‹åºï¼Œè€Œä¸éœ€è¦çœŸçš„èŠ±é’±å»ä¹° SOL ä»£å¸ï¼š</p>
<pre><code class="bash">solana config set --url https://api.devnet.solana.com
</code></pre>
<h3 id="6-åˆ›å»ºæœ¬åœ°è´¦æˆ·æ–‡ä»¶"><a href="#6-åˆ›å»ºæœ¬åœ°è´¦æˆ·æ–‡ä»¶" class="headerlink" title="6. åˆ›å»ºæœ¬åœ°è´¦æˆ·æ–‡ä»¶"></a>6. åˆ›å»ºæœ¬åœ°è´¦æˆ·æ–‡ä»¶</h3><p>è¿™ä¸ªå‘½ä»¤ç”¨äºåœ¨ä½ æœ¬åœ°çš„é»˜è®¤è·¯å¾„ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æ¥éƒ¨ç½²æ™ºèƒ½åˆçº¦çš„ Solana è´¦æˆ·ã€‚å› ä¸ºéƒ¨ç½²æ™ºèƒ½åˆçº¦éœ€è¦æ¶ˆè€—æ‰‹ç»­è´¹ï¼Œè¿™äº›æ‰‹ç»­è´¹éœ€è¦ä¸€ä¸ªè´¦æˆ·æ¥æ”¯ä»˜ï¼š</p>
<pre><code class="bash">solana-keygen new -o ~/.config/solana/id.json  
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤çš„è¿è¡Œç»“æœä¸­ï¼Œæœ‰ä¸€è¡Œ <code>pubkey: </code> å¼€å¤´çš„è¾“å‡ºï¼Œpubkey åé¢çš„å°±æ˜¯ä½ æœ¬åœ°çš„è´¦æˆ·åœ°å€ã€‚å› ä¸ºä¸Šä¸€ä¸ªæ­¥éª¤å·²ç»è®¾ç½®äº† devnet ä¸ºé»˜è®¤ç½‘ç»œï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ä½ æœ¬åœ°è´¦æˆ·çš„ä½™é¢ï¼š</p>
<pre><code class="bash">solana balance
</code></pre>
<p>ä¹Ÿå¯ä»¥æ‰“å¼€ devnet çš„ <a href="https://explorer.solana.com/?cluster=devnet">æµè§ˆå™¨</a>ï¼Œæœç´¢ä½ åˆšæ‰ç”Ÿæˆçš„åœ°å€ã€‚æœç´¢ä¹‹åçš„ URL å½¢å¦‚ï¼š
<a href="https://explorer.solana.com/address/75sFifxBt7zw1YrDfCdPjDCGDyKEqLWrBarPCLg6PHwb?cluster=devnet">https://explorer.solana.com/address/75sFifxBt7zw1YrDfCdPjDCGDyKEqLWrBarPCLg6PHwb?cluster=devnet</a></p>
<p>å½“ç„¶ï¼Œä½ ä¼šå‘ç°è‡ªå·±çš„è´¦æˆ·ä½™é¢æ˜¯ <code>0 SOL</code>ã€‚</p>
<h3 id="7-é¢†å–-devnet-ä¸Šçš„ç©ºæŠ•"><a href="#7-é¢†å–-devnet-ä¸Šçš„ç©ºæŠ•" class="headerlink" title="7. é¢†å– devnet ä¸Šçš„ç©ºæŠ•"></a>7. é¢†å– devnet ä¸Šçš„ç©ºæŠ•</h3><p>è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œä½ çš„è´¦æˆ·å°±å¯ä»¥æ”¶åˆ° 2 ä¸ª SOLã€‚å…¶ä¸­å‚æ•°é‡Œçš„ 2 å°±æ˜¯è¯·æ±‚å‘æ”¾ 2 ä¸ª SOL çš„æ„æ€ã€‚å› ä¸ºé¢†æ°´çš„é¢åº¦é™åˆ¶ï¼Œä½ åªèƒ½ä¸€æ¬¡æ€§æœ€å¤šé¢† 2 ä¸ªã€‚ä¸ç”¨æ‹…å¿ƒå¤ªå°‘ï¼Œè¶³å¤Ÿæˆ‘ä»¬æ¥ä¸‹æ¥çš„æ­¥éª¤ä½¿ç”¨äº†ã€‚</p>
<pre><code class="bash">solana airdrop 2
</code></pre>
<h3 id="8-éƒ¨ç½²åˆçº¦åˆ°-devnet"><a href="#8-éƒ¨ç½²åˆçº¦åˆ°-devnet" class="headerlink" title="8. éƒ¨ç½²åˆçº¦åˆ° devnet"></a>8. éƒ¨ç½²åˆçº¦åˆ° devnet</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†æ™ºèƒ½åˆçº¦ä»£ç ï¼Œæœ‰äº†æœ¬åœ°è´¦æˆ·ï¼Œå¹¶ä¸”æœ¬åœ°è´¦æˆ·é‡Œæœ‰ SOL ä½™é¢ã€‚ç°åœ¨å¯ä»¥éƒ¨ç½²åˆçº¦åˆ° devnet ä¸Šäº†ã€‚è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼š</p>
<pre><code class="bash">anchor deploy --provider.cluster devnet 
</code></pre>
<p>å¦‚æœéƒ¨ç½²æˆåŠŸï¼Œä¼šçœ‹åˆ° <code>Deploy success</code> çš„å­—æ ·ã€‚å‘½ä»¤è¡Œè¾“å‡ºä¸­è¿˜æœ‰ä¸€è¡Œéœ€è¦ç•™æ„ï¼Œ<code>Program Id: </code> åé¢çš„ï¼Œå°±æ˜¯éƒ¨ç½²ä¹‹åçš„åˆçº¦åœ°å€ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ devnet çš„æµè§ˆå™¨ä¸Šæœç´¢è¿™ä¸ªåœ°å€ï¼Œç„¶åçœ‹åˆ°ç±»ä¼¼è¿™ä¸ª URL çš„é¡µé¢ï¼ŒURL ä¸­çš„ <code>3Zbdw1oWu1CiMiQr3moQeT4XzMgeqmCvjH5R5wroDWQH</code> å°±æ˜¯æˆ‘éƒ¨ç½²çš„åˆçº¦åœ°å€ï¼š<a href="https://explorer.solana.com/address/3Zbdw1oWu1CiMiQr3moQeT4XzMgeqmCvjH5R5wroDWQH?cluster=devnet">https://explorer.solana.com/address/3Zbdw1oWu1CiMiQr3moQeT4XzMgeqmCvjH5R5wroDWQH?cluster=devnet</a></p>
<h3 id="9-è°ƒç”¨é“¾ä¸Šåˆçº¦"><a href="#9-è°ƒç”¨é“¾ä¸Šåˆçº¦" class="headerlink" title="9. è°ƒç”¨é“¾ä¸Šåˆçº¦"></a>9. è°ƒç”¨é“¾ä¸Šåˆçº¦</h3><p>åˆ° <code>hello_sol/app</code> ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªå« <code>app.js</code> çš„æ–‡ä»¶ï¼ŒæŠŠè¿™äº›ä»£ç å¤åˆ¶è¿›å»ã€‚ç®€å•æ¥è¯´ï¼Œè¿™æ®µä»£ç è¯»å–äº†ä½ æœ¬åœ°é»˜è®¤çš„è´¦æˆ·æ–‡ä»¶ï¼Œç„¶åç”¨ä½ çš„ Solana è´¦æˆ·å‘èµ·ä¸€ç¬”å¯¹æ™ºèƒ½åˆçº¦è°ƒç”¨çš„äº¤æ˜“ï¼Œè¿™ä¸ªè„šæœ¬æ¯æ‰§è¡Œä¸€æ¬¡ï¼Œå°±ä¼šåœ¨é“¾ä¸Šåˆ›å»ºä¸€ç¬”äº¤æ˜“ã€‚ï¼š</p>
<pre><code class="javascript">const anchor = require(&#39;@coral-xyz/anchor&#39;);
const fs     = require(&#39;fs&#39;);
const os     = require(&#39;os&#39;);
const path   = require(&#39;path&#39;);
const &#123; Keypair, Connection &#125; = anchor.web3;

const RPC_URL    = process.env.RPC_URL;
const connection = new Connection(RPC_URL, &#123; commitment: &#39;confirmed&#39; &#125;);

const secretKey = Uint8Array.from(
  JSON.parse(
    fs.readFileSync(
      path.join(os.homedir(), &#39;.config/solana/id.json&#39;),
      &#39;utf8&#39;,
    ),
  ),
);

const wallet   = new anchor.Wallet(Keypair.fromSecretKey(secretKey));
const provider = new anchor.AnchorProvider(connection, wallet, &#123;
  preflightCommitment: &#39;confirmed&#39;,
&#125;);
anchor.setProvider(provider);

const idlPath = path.resolve(__dirname, &#39;../target/idl/hello_sol.json&#39;);
const idl     = JSON.parse(fs.readFileSync(idlPath, &#39;utf8&#39;));
const program = new anchor.Program(idl, provider);

(async () =&gt; &#123;
  try &#123;
    const sig = await program.methods.sayHello().rpc();
    console.log(&#39;âœ… tx&#39;, sig);
    console.log(`ğŸŒ https://explorer.solana.com/tx/$&#123;sig&#125;?cluster=devnet`);
  &#125; catch (err) &#123;
    console.error(&#39;âŒ&#39;, err);
  &#125;
&#125;)();
</code></pre>
<p>è¿”å› <code>hello_sol</code> é¡¹ç›®çš„é¡¶å±‚ç›®å½•ï¼Œæ‰§è¡Œè¿™äº›å‘½ä»¤æ¥å®‰è£… nodejs çš„ä¾èµ–ï¼š</p>
<pre><code>npm init -y 
npm install @coral-xyz/anchor
</code></pre>
<p>ç„¶åè®°å¾—ç°åœ¨ä»ç„¶æ˜¯åœ¨é¡¶å±‚ç›®å½•ï¼Œè¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œæ¥æ‰§è¡Œåˆšæ‰å†™çš„ <code>app.js</code> è„šæœ¬ï¼Œè„šæœ¬ä¼šåˆ° devnet ä¸Šè°ƒç”¨æˆ‘ä»¬éƒ¨ç½²çš„æ™ºèƒ½åˆçº¦ï¼š</p>
<pre><code class="bash">export RPC_URL=https://api.devnet.solana.com
node app/app.js
</code></pre>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªç¯å¢ƒå˜é‡ <code>RPC_URL</code> æ˜¯è„šæœ¬è¯·æ±‚çš„ API åœ°å€ï¼Œå› ä¸º nodejs è„šæœ¬é»˜è®¤ä¸èµ°ç³»ç»Ÿä»£ç†ï¼Œæ‰€ä»¥å¯¹äºç½‘ç»œå—é˜»çš„åŒå­¦ï¼Œéœ€è¦ç”¨ä¸€ä¸ªæ¯”å…¬å¼€ RPC æ›´å¥½ç”¨çš„ API åœ°å€ã€‚å¯ä»¥ä½¿ç”¨ä¾‹å¦‚ <a href="https://www.helius.dev/">Helius</a> çš„æœåŠ¡ï¼Œæ³¨å†Œä¸€ä¸ªå…è´¹çš„è´¦å·å°±å¯ä»¥äº†ã€‚å‡å¦‚æ‰§è¡Œè„šæœ¬çš„è¿‡ç¨‹ä¸­é‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼Œé‚£å°±è¯´æ˜æ˜¯ç½‘ç»œé—®é¢˜ï¼Œæ¢ä¸€ä¸ªå¥½ç”¨çš„ RPC åœ°å€å°±å¥½äº†ï¼š</p>
<pre><code class="javascript">âŒ Error: failed to get recent blockhash: TypeError: fetch failed
    at Connection.getLatestBlockhash (/Users/smallyu/work/github/hello_sol/node_modules/@solana/web3.js/lib/index.cjs.js:7236:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async AnchorProvider.sendAndConfirm (/Users/smallyu/work/github/hello_sol/node_modules/@coral-xyz/anchor/dist/cjs/provider.js:89:35)
    at async MethodsBuilder.rpc [as _rpcFn] (/Users/smallyu/work/github/hello_sol/node_modules/@coral-xyz/anchor/dist/cjs/program/namespace/rpc.js:15:24)
    at async /Users/smallyu/work/github/hello_sol/app/app.js:40:17
</code></pre>
<p>ä½ ä¹Ÿè®¸å¥½å¥‡ä¸ºä»€ä¹ˆä¸éœ€è¦æŒ‡å®šè°ƒç”¨çš„åˆçº¦åœ°å€ï¼Œè¿™ä¸ªè„šæœ¬æ€ä¹ˆçŸ¥é“ä½ åˆšæ‰ï¼Œéƒ¨ç½²åˆ°é“¾ä¸Šçš„åˆçº¦åœ¨å“ªé‡Œï¼Ÿæ³¨æ„çœ‹è„šæœ¬ä¸­æœ‰ä¸€ä¸ª <code>idlPath</code> çš„å˜é‡ï¼Œä½ å¯ä»¥ç›´æ¥æ‰“å¼€è¿™ä¸ªè·¯å¾„çš„æ–‡ä»¶ <code>target/idl/hello_sol.json</code> æŸ¥çœ‹ï¼Œé‡Œé¢æ˜¯ä¸€äº›åˆçº¦ç¼–è¯‘åçš„å…ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬åˆçº¦çš„åœ°å€ä¹Ÿåœ¨é‡Œé¢ï¼Œæ²¡é”™åˆçº¦åœ°å€æ˜¯ç¦»çº¿ç”Ÿæˆçš„ï¼Œä¸éœ€è¦ä¸Šé“¾ï¼Œåˆçº¦å°±æœ‰å±äºè‡ªå·±çš„å”¯ä¸€åœ°å€äº†ã€‚</p>
<p>å¦‚æœæ‰§è¡Œè„šæœ¬æ²¡æœ‰è¾“å‡ºé”™è¯¯ï¼Œå°±ä¼šçœ‹åˆ°ç»ˆç«¯æ‰“å°å‡ºäº†è¿™ä¸€æ¬¡è°ƒç”¨åˆçº¦çš„äº¤æ˜“å“ˆå¸Œï¼Œä»¥åŠå¯ä»¥ç›´æ¥å¤åˆ¶è®¿é—®çš„æµè§ˆå™¨ URLï¼Œä¾‹å¦‚è¿™å°±æ˜¯ä¸€ç¬”è°ƒç”¨åˆçº¦çš„äº¤æ˜“ï¼š
<a href="https://explorer.solana.com/tx/2fnPgKkv3tGKKq72hhRxmW6WFSXuofMzXfY2UYoFZXTdJi37btdESy9NzS2gjpWzXX4CL5F7QfxugpctBVaMcBFY?cluster=devnet">https://explorer.solana.com/tx/2fnPgKkv3tGKKq72hhRxmW6WFSXuofMzXfY2UYoFZXTdJi37btdESy9NzS2gjpWzXX4CL5F7QfxugpctBVaMcBFY?cluster=devnet</a></p>
<p>è¿™ç¬”äº¤æ˜“é¡µé¢çš„æœ€ä¸‹æ–¹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å†™çš„æ™ºèƒ½åˆçº¦åœ¨è¢«äº¤æ˜“è°ƒç”¨åï¼Œæ‰“å°å‡ºäº† <code>Program logged: &quot;Hello, world!&quot;</code> çš„æ—¥å¿—ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬å†™åœ¨åˆçº¦ä»£ç ä¸­çš„ msgã€‚</p>
<h3 id="10-Troubleshooting"><a href="#10-Troubleshooting" class="headerlink" title="10. Troubleshooting"></a>10. Troubleshooting</h3><p>å¦‚æœåœ¨æ‰§è¡Œä¸Šè¿°å‘½ä»¤æˆ–è€…ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†é”™è¯¯ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘æ˜¯å‘½ä»¤è¡Œå·¥å…·ç‰ˆæœ¬çš„é—®é¢˜ã€‚ç”±äºåŒºå—é“¾è¡Œä¸šå’ŒæŠ€æœ¯è¿­ä»£æ¯”è¾ƒå¿«ï¼Œå¾ˆå®¹æ˜“å‡ºç°ç‰ˆæœ¬ä¸å…¼å®¹çš„æƒ…å†µã€‚æˆ‘æœ¬åœ°çš„ç¯å¢ƒå’Œç‰ˆæœ¬æ˜¯ï¼š</p>
<pre><code class="text">rustup: rustup 1.28.2 (e4f3ad6f8 2025-04-28)
rustc: rustc 1.90.0-nightly (706f244db 2025-06-23)
solana: solana-cli 2.2.18 (src:8392f753; feat:3073396398, client:Agave)
archor: anchor-cli 0.31.1
node: v24.2.0
@coral-xyz/anchor(nodejs): ^0.31.1
</code></pre>
<p><br><br></p>
<h2 id="å¼€å‘æ•™ç¨‹-2"><a href="#å¼€å‘æ•™ç¨‹-2" class="headerlink" title="å¼€å‘æ•™ç¨‹-2"></a>å¼€å‘æ•™ç¨‹-2</h2><p>æˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•åˆ›å»ºæ™ºèƒ½åˆçº¦é¡¹ç›®ã€éƒ¨ç½²åˆçº¦ä»¥åŠè°ƒç”¨è¿ä¸Šåˆçº¦ï¼Œæ¥ä¸‹æ¥æ·±å…¥äº†è§£ä¸€ä¸‹æ™ºèƒ½åˆçº¦ç¼–ç¨‹è¯­è¨€çš„å†™æ³•ï¼Œå…³æ³¨å¦‚ä½•å†™å‡ºè‡ªå·±æƒ³è¦çš„é€»è¾‘ã€‚æˆ‘ä»¬å°†ä¼šä»¥å†™ä¸€ä¸ªç®€å•çš„ USDT ä»£å¸åˆçº¦ä¸ºä¾‹ï¼Œåˆ†æç›¸å…³çš„ä»£ç ï¼Œå¹¶ä¸”ç†è§£ Solana æ™ºèƒ½åˆçº¦çš„å†™æ³•ã€‚</p>
<h3 id="1-åˆ›å»ºé¡¹ç›®"><a href="#1-åˆ›å»ºé¡¹ç›®" class="headerlink" title="1. åˆ›å»ºé¡¹ç›®"></a>1. åˆ›å»ºé¡¹ç›®</h3><p>ç”¨æˆ‘ä»¬å·²ç»å­¦ä¼šçš„å‘½ä»¤ï¼Œæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼š</p>
<pre><code class="bash">anchor init usdt_clone
</code></pre>
<h3 id="2-é…ç½®æ–‡ä»¶"><a href="#2-é…ç½®æ–‡ä»¶" class="headerlink" title="2. é…ç½®æ–‡ä»¶"></a>2. é…ç½®æ–‡ä»¶</h3><p>å¯ä»¥æ³¨æ„åˆ°é¡¹ç›®è·¯å¾„ <code>programs/usdt_clone/Cargo.toml</code> ä¸‹çš„è¿™ä¸ªæ–‡ä»¶ï¼ŒCargo æ˜¯ Rust è¯­è¨€å¸¸ç”¨çš„åŒ…ç®¡ç†å™¨ï¼Œè¿™ä¸ª <code>Cargo.toml</code> åˆ™æ˜¯åŒ…ç®¡ç†å™¨çš„é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº†è¦å¼•å…¥å“ªäº›ä¾èµ–åº“ï¼Œä»¥åŠä¾èµ–åº“çš„ç‰ˆæœ¬ã€‚æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶é‡Œæœ‰è¿™ä¹ˆä¸¤è¡Œï¼š</p>
<pre><code class="Rsut">[dependencies]
anchor-lang = &quot;0.31.1&quot;
</code></pre>
<p>Anchor æä¾›çš„å®æ˜¯ Solana æ™ºèƒ½åˆçº¦çš„å…³é”®ï¼Œå®çš„å½¢å¼å¦‚ <code>#[program]</code>ã€<code>#[account]</code> ç­‰ï¼Œè¿™äº›å®ä¼šå‘Šè¯‰ Solana çš„ SVM è™šæ‹Ÿæœºï¼Œç¨‹åºä»å“ªé‡Œå¼€å§‹ã€æ•°æ®ç»“æ„åœ¨å“ªé‡Œå®šä¹‰ç­‰ã€‚å¦‚æœæ²¡æœ‰ Anchor è¿™ä¸ªä¾èµ–ï¼Œåˆçº¦é¡¹ç›®å°±æ˜¯æ™®é€šçš„ Rust è¯­è¨€é¡¹ç›®äº†ï¼ŒSolana çš„æ™ºèƒ½åˆçº¦ç³»ç»Ÿæ— æ³•è¯†åˆ«å’Œè§£æã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†ï¼ŒSolana çš„æ™ºèƒ½åˆçº¦ï¼Œæ˜¯å¦‚ä½•åˆ©ç”¨ Rust è¯­è¨€æ¥å®ç°çš„ã€‚</p>
<h3 id="3-åˆçº¦åœ°å€"><a href="#3-åˆçº¦åœ°å€" class="headerlink" title="3. åˆçº¦åœ°å€"></a>3. åˆçº¦åœ°å€</h3><p>æˆ‘ä»¬è¿‘è·ç¦»çœ‹ä¸€ä¸‹åˆçº¦çš„ä»£ç æ–‡ä»¶ <code>usdt_clone/programs/usdt_clone/src/lib.rs</code>ã€‚æ–‡ä»¶çš„ç¬¬ä¸€è¡Œå†…å®¹æ˜¯è¿™æ ·ï¼Œ<code>use</code> æŠŠ Anchor å¸¸ç”¨çš„ç±»å‹ä¸€ä¸‹å­å…¨éƒ¨å¯¼å…¥è¿›æ¥äº†ï¼Œè¿™æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä¸éœ€è¦ä¿®æ”¹ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­ç¼–å†™ç¨‹åºã€‚ï¼š</p>
<pre><code class="Rsut">use anchor_lang::prelude::*;
</code></pre>
<p>ç¬¬äºŒè¡Œå†…å®¹æ˜¯ä¸€ä¸ªå¯¹ <code>declare_id</code> å‡½æ•°çš„è°ƒç”¨ï¼Œ<code>declare_id</code> å£°æ˜äº†å½“å‰è¿™ä¸ªæ™ºèƒ½åˆçº¦é¡¹ç›®çš„ Program IDï¼Œä¹Ÿå°±æ˜¯åˆçº¦åœ°å€æ˜¯ä»€ä¹ˆï¼Œä¹‹å‰æˆ‘ä»¬æåˆ°è¿‡ï¼ŒSolana çš„æ™ºèƒ½åˆçº¦åœ°å€ï¼Œæ˜¯å¯ä»¥ç¦»çº¿ç”Ÿæˆçš„ã€‚</p>
<pre><code class="Rsut">declare_id!(&quot;CFmGdHuqDymqJYBX44fyNjrFoJx6wRkZPkYgZqfkAQvT&quot;);
</code></pre>
<p>è¿™ä¸ªåˆçº¦åœ°å€æ˜¯ä¸€ä¸ªéšæœºå€¼ï¼Œä½†ä¸æ˜¯éšæ„æ ¼å¼çš„å€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ª Ed25529 çš„å…¬é’¥ã€‚å‡å¦‚ä½ æ‰‹åŠ¨æŠŠæœ€åä¸€ä¸ªå­—ç¬¦ <code>T</code> æ”¹ä¸º <code>t</code>ï¼Œè¿™æ•´ä¸ªå­—ç¬¦ä¸²å°±ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„å…¬é’¥äº†ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼å¯ä»¥éšæœºç”Ÿæˆï¼Œä½†æ˜¯ä¸èƒ½éšä¾¿æ”¹ã€‚é‚£ä¹ˆæ—¢ç„¶æ˜¯å…¬é’¥ï¼Œå®ƒçš„ç§é’¥åœ¨å“ªé‡Œå‘¢ï¼Ÿåœ¨åˆå§‹åŒ–é¡¹ç›®çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç§é’¥ï¼Œæ–‡ä»¶ä½ç½®åœ¨ <code>target/deploy/usdt_clone-keypair.json</code>ï¼Œå¯ä»¥æ‰“å¼€çœ‹åˆ°æ˜¯ä¸€äº›å­—èŠ‚æ•°ç»„ï¼Œ<code>declare_id</code> ä½¿ç”¨çš„å…¬é’¥ï¼Œå°±æ˜¯æ ¹æ®è¿™ä¸ªç§é’¥ç”Ÿæˆçš„ã€‚</p>
<h3 id="4-å‚¨å­˜æ•°æ®ç»“æ„"><a href="#4-å‚¨å­˜æ•°æ®ç»“æ„" class="headerlink" title="4. å‚¨å­˜æ•°æ®ç»“æ„"></a>4. å‚¨å­˜æ•°æ®ç»“æ„</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ–°å¢ä¸€äº›è‡ªå·±çš„é€»è¾‘ï¼Œåœ¨ <code>declare_id</code> è¯­å¥çš„ä¸‹æ–¹ï¼Œå†™å…¥è¿™ä¸ªä»£ç ï¼š</p>
<pre><code class="Rsut">#[account]
pub struct Mint &#123;
    pub decimals: u8,
    pub mint_authority: Pubkey,
&#125;
</code></pre>
<p>å¯ä»¥ç†è§£ä¸º <code>#[account]</code> å®æ˜¯ç”¨æ¥å®šä¹‰æ•°æ®ç»“æ„çš„ï¼ŒAnchor é»‘é­”æ³•ä¼šåœ¨èƒŒåè¿›è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œè®©æˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¿™ä¸ªæ•°æ®ç»“æ„åœ¨é“¾ä¸Šè¿›è¡Œè¯»å†™æ“ä½œã€‚è¿™é‡Œçš„ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå« <code>Mint</code> çš„ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“åŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œ<code>decimals</code> æŒ‡å®š USDT ä»£å¸çš„ç²¾åº¦æ˜¯å¤šå°‘ï¼Œ<code>mint_authority</code> æŒ‡å®šè°å¯ä»¥æ¥æŒ–æ–°çš„å¸ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­å®šä¹‰å¦ä¸€ä¸ªç»“æ„ä½“ï¼Œç”¨æ¥å‚¨å­˜æ¯ä¸€ä¸ªç”¨æˆ·çš„ä»£å¸æ•°é‡ã€‚<code>owner</code> å°±æ˜¯ç”¨æˆ·åœ°å€ï¼Œ<code>balance</code> åˆ™æ˜¯ç”¨æˆ·çš„ä½™é¢ï¼š</p>
<pre><code class="Rsut">#[account]
pub struct TokenAccount &#123;
    pub owner: Pubkey,
    pub balance: u64,
&#125;
</code></pre>
<h3 id="5-è´¦æˆ·çº¦æŸç»“æ„"><a href="#5-è´¦æˆ·çº¦æŸç»“æ„" class="headerlink" title="5. è´¦æˆ·çº¦æŸç»“æ„"></a>5. è´¦æˆ·çº¦æŸç»“æ„</h3><p>ä½ å¯èƒ½æ³¨æ„åˆ°å½“å‰çš„ä»£ç æ–‡ä»¶æœ€åº•éƒ¨ï¼Œè¿˜æœ‰ä¸¤è¡Œè‡ªåŠ¨ç”Ÿæˆçš„ <code>#[derive(Accounts)]</code> å¼€å¤´çš„ä»£ç ã€‚è¿™ä¸ªå®æ˜¯ç”¨æ¥ç»™è´¦æˆ·å†™ä¸€äº›çº¦æŸè§„åˆ™çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>#[derive(Accounts)]</code> å†…éƒ¨å®šä¹‰ä¸€äº›å‡½æ•°ï¼Œç„¶åå†ç”¨ <code>#[account]</code> æ¥å®šä¹‰ç»“æ„ä½“ï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æ„ä½“å°±è‡ªåŠ¨æ‹¥æœ‰äº†æ‰€æœ‰å‡½æ•°ã€‚ç±»ä¼¼äºç»™ç»“æ„ä½“å®šä¹‰æˆå‘˜å‡½æ•°çš„æ„æ€ã€‚</p>
<p>æŠŠåŸæœ¬çš„ <code>Initialize</code> ä»£ç åˆ æ‰ï¼š</p>
<pre><code class="Rsut">#[derive(Accounts)]
pub struct Initialize &#123;&#125;    // åˆ é™¤
</code></pre>
<p>ç„¶åå†™å…¥æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘ï¼š</p>
<pre><code class="Rust">#[derive(Accounts)]
pub struct InitMint&lt;&#39;info&gt; &#123;
    #[account(
        init, 
        payer = authority,
        space = 8 + 1 + 32
    )]
    pub mint: Account&lt;&#39;info, Mint&gt;,

    #[account(mut)]
    pub authority: Signer&lt;&#39;info&gt;,

    pub system_program: Program&lt;&#39;info, System&gt;,
&#125;
</code></pre>
<p>è¿™æ®µä»£ç æœ‰ç‚¹å¤æ‚ã€‚æˆ‘ä»¬å…ˆçœ‹ <code>#[account(...)]</code> è¿™ä¸€æ®µï¼Œè¿™é‡Œç»™ <code>account()</code> å‡½æ•°ä¼ é€’äº† 3 ä¸ªå‚æ•°è¿›å»ï¼Œ<code>account()</code> å‡½æ•°çš„å‚æ•°ç±»å‹æ˜¯ Anchor æ¡†æ¶å®šä¹‰çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>init</code> æ˜¯ä¸€ä¸ªå›ºå®šçš„å…³é”®å­—ï¼Œä¸éœ€è¦å€¼ï¼Œè¡¨ç¤ºå¦‚æœè´¦æˆ·ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„è´¦æˆ·ã€‚ç¬¬äºŒä¸ªå‚æ•° <code>payer</code> æ˜¯éœ€è¦å€¼çš„ï¼Œè¡¨ç¤ºè°æ¥æ”¯ä»˜åˆ›å»ºè´¦æˆ·çš„æ‰‹ç»­è´¹ã€‚ç¬¬ä¸‰ä¸ªå‚æ•° <code>space</code> çš„å€¼åˆ™æ˜¯æˆ‘ä»¬è‡ªå·±è®¡ç®—çš„ï¼Œç³»ç»Ÿå¿…é¡»é¢„ç•™ 8 + <code>Mint</code> ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå­—æ®µç±»å‹ <code>u8</code> éœ€è¦ç©ºé—´ 1 + <code>Mint</code> ç»“æ„ä½“çš„ç¬¬äºŒä¸ªå­—æ®µç±»å‹ <code>Pubkey</code> éœ€è¦ç©ºé—´ 32ã€‚</p>
<p>è¿™ä¸ª <code>#[account(...)]</code> çš„å®ç”¨æ¥ä¿®é¥° <code>mint</code> æˆå‘˜å˜é‡ã€‚æˆ‘ä»¬æ¥ç€çœ‹ <code>mint</code> è¿™ä¸ªæˆå‘˜å˜é‡ï¼Œ<code>Account</code> æ˜¯ Anchor æ¡†æ¶æä¾›çš„å†…ç½®çš„è´¦æˆ·ç±»å‹ï¼Œå¯ä»¥å¯¹å‚¨å­˜æ•°æ®ç»“æ„è¿›è¡Œè¯»å†™ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„ <code>Mint</code> æˆ–è€… <code>TokenAccount</code> ç»“æ„ï¼Œè¿™ä¸ª <code>mint</code> æˆå‘˜å˜é‡å®é™…æ“ä½œè¿™äº›ç±»å‹çš„æ•°æ®ã€‚è€Œ <code>Account</code> æ¥å—ä¸¤ä¸ªæ³›å‹å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>Mint</code> æŒ‡æ˜äº†è¿™ä¸ªè´¦æˆ·æ˜¯åœ¨å¤„ç† <code>Mint</code> ç±»å‹çš„ç»“æ„ï¼Œè€Œä¸æ˜¯ <code>TokenAccount</code> æˆ–è€…å…¶ä»–ã€‚</p>
<p>æ¥ç€çœ‹ <code>#[account(mut)]</code> è¿™ä¸ªå®ï¼Œmut çš„æ„æ€æ˜¯è´¦æˆ·é‡‘é¢å¯ä»¥å˜åŒ–ã€‚<code>authority</code> ä¹Ÿæ˜¯ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œå®ƒçš„ç±»å‹åŒæ ·æ˜¯ä¸€ä¸ª Anchor å†…ç½®çš„è´¦æˆ·ç±»å‹ <code>Signer</code>ï¼Œä¸ <code>Account</code> ä¸åŒçš„æ˜¯ï¼Œ<code>Signer</code> æ„å‘³ç€éœ€è¦ä¼ å…¥è´¦æˆ·æŒæœ‰è€…æœ¬äººç­¾åï¼Œæ‰ç¬¦åˆç±»å‹å®šä¹‰ã€‚åé¢çš„ <code>â€˜info</code> åˆ™æ˜¯ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œå…¶ä¸­ <code>info</code> æ˜¯ç»“æ„ä½“çš„æ³›å‹ä¼ é€’è¿›æ¥çš„ã€‚è‡³äº <code>info</code> å‰é¢çš„å•å¼•å· <code>&#39;</code>ï¼Œæ˜¯ Rust è¯­è¨€é‡Œçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå¯¹å‚æ•°çš„å¼•ç”¨ä¼ é€’ã€‚æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸¤è¡Œä»£ç çš„å®å’Œè¯­å¥ï¼Œå…±åŒå®šä¹‰äº†ä¸€ä¸ªå¯ä»¥å¯¹å…¶æ‰£è´¹çš„è´¦æˆ·åœ°å€ä½œä¸ºæˆå‘˜å˜é‡ã€‚</p>
<p>æœ€åçš„ <code>system_program</code> æˆå‘˜å˜é‡ï¼Œå¯ä»¥æŠŠè¿™ä¸€è¡Œç†è§£ä¸ºå›ºå®šå†™æ³•ï¼Œåªè¦åˆçº¦éœ€è¦è½¬è´¦ SOLï¼Œå°±å¾—å†™ä¸Šè¿™ä¸€è¡Œã€‚æ€»çš„æ¥è¯´ï¼Œè¿™å‡ è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ªæ–°çš„ç»“æ„ä½“ <code>InitMint</code>ï¼Œè¿™ä¸ªç»“æ„ä½“æ˜¯åŸºäº <code>Mint</code> è¿›è¡ŒåŒ…è£…çš„ï¼ŒåŒ…è£…åçš„ <code>InitMint</code> æ‹¥æœ‰äº†ä¸€äº›è´¦æˆ·ç›¸å…³çš„å±æ€§ã€‚</p>
<h3 id="6-ä»£å¸åˆçº¦åˆå§‹åŒ–"><a href="#6-ä»£å¸åˆçº¦åˆå§‹åŒ–" class="headerlink" title="6. ä»£å¸åˆçº¦åˆå§‹åŒ–"></a>6. ä»£å¸åˆçº¦åˆå§‹åŒ–</h3><p>æ¥ä¸‹æ¥å¼€å§‹å…³æ³¨ <code>#[program]</code> å®å®šä¹‰çš„å‡½æ•°ã€‚è¿™ä¸ªå®ç”¨æ¥æ ‡æ³¨æ™ºèƒ½åˆçº¦çš„ç¨‹åºå…¥å£ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£æ‰§è¡Œåˆçº¦é€»è¾‘çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬å½“å‰æ–‡ä»¶é‡Œæœ‰å‡ è¡Œé»˜è®¤çš„ä»£ç ï¼š</p>
<pre><code class="Rust">#[program]
pub mod usdt_clone &#123;
    use super::*;

    pub fn initialize(ctx: Context&lt;Initialize&gt;) -&gt; Result&lt;()&gt; &#123;   // åˆ é™¤
        msg!(&quot;Greetings from: &#123;:?&#125;&quot;, ctx.program_id);             // åˆ é™¤
        Ok(())                                                    // åˆ é™¤
    &#125;                                                             // åˆ é™¤
&#125;
</code></pre>
<p>åˆ æ‰è¿™ä¸ªé¡¹ç›®è‡ªåŠ¨ç”Ÿæˆçš„ <code>initialize</code> å‡½æ•°ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªå‡½æ•°ï¼š</p>
<pre><code class="Rust">pub fn init_mint(ctx: Context&lt;InitMint&gt;, decimals: u8) -&gt; Result&lt;()&gt; &#123;
    let mint = &amp;mut ctx.accounts.mint;
    mint.decimals = decimals;
    mint.mint_authority = ctx.accounts.authority.key();
    Ok(())
&#125;
</code></pre>
<p>æŠŠè¿™ä¸ª <code>init_mint</code> å‡½æ•°æ”¾åœ¨åŸå…ˆ <code>initialize</code> å‡½æ•°çš„ä½ç½®ã€‚å¦‚æœæŠ›å¼€ Anchor çš„å®ï¼Œè¿™ä¸ªå‡½æ•°åˆ™æ˜¯ä¸€ä¸ªæ™®é€šçš„ Rust è¯­æ³•å®šä¹‰çš„å‡½æ•°ã€‚<code>Context</code> ç±»å‹æ˜¯ Anchor æä¾›çš„åŒ…è£…ç±»å‹ æ‰€ä»¥ä½ ä¹Ÿè®¸å¥½å¥‡æˆ‘ä»¬æ˜æ˜æ²¡æœ‰å®šä¹‰ <code>Context</code>ï¼Œä½†æ˜¯è¿™é‡Œå´ç›´æ¥ä½¿ç”¨äº†ã€‚<code>InitMint</code> ç±»å‹æ˜¯åˆ™æˆ‘ä»¬ä¸Šä¸€ä¸ªæ­¥éª¤å®šä¹‰å¥½çš„ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ <code>InitMint</code>ï¼Œè¡¨ç¤ºå“ªä¸ªè´¦æˆ·æ‹¥æœ‰é“¸å¸æƒé™ã€‚ç¬¬äºŒä¸ªå‚æ•°ç±»å‹æ˜¯ <code>u8</code>ï¼Œè¡¨ç¤º USDT çš„ç²¾åº¦æ˜¯å¤šå°‘ä½ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªç©ºçš„å…ƒç»„ <code>()</code>ï¼Œè¯´æ˜å¦‚æœæˆåŠŸä»€ä¹ˆéƒ½ä¸è¿”å›ï¼Œå¦‚æœå¤±è´¥åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>å‡½æ•°å†…éƒ¨çš„é€»è¾‘ç›¸å¯¹å¥½ç†è§£ï¼Œå‡½æ•°æŠŠå‚æ•°æ¥æ”¶è¿›æ¥çš„æ•°æ®ï¼Œèµ‹å€¼ç»™äº†ä¸€ä¸ªå« <code>mint</code> çš„å˜é‡ï¼Œè¦æ³¨æ„è¿™ä¸æ˜¯æ™®é€šçš„æ–°å®šä¹‰çš„å˜é‡ï¼Œè€Œæ˜¯ä» <code>ctx.accounts</code> ååºåˆ—åŒ–è¿‡æ¥çš„ã€<code>mut</code> å£°æ˜çš„å¯å˜ç±»å‹çš„å˜é‡ï¼Œç›¸å½“äºç›´æ¥ä¿®æ”¹ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„ç»“æ„ä½“å†…çš„å±æ€§å€¼ï¼Œæ‰€ä»¥åªè¦ç»™ <code>mint</code> èµ‹å€¼ï¼Œç»“æ„ä½“å†…çš„æ•°æ®éƒ½ä¼šä¿å­˜ä¸‹æ¥ï¼Œä¹Ÿå°±æ˜¯ä¿å­˜åˆ°é“¾ä¸Šã€‚</p>
<h3 id="7-å•å…ƒæµ‹è¯•"><a href="#7-å•å…ƒæµ‹è¯•" class="headerlink" title="7. å•å…ƒæµ‹è¯•"></a>7. å•å…ƒæµ‹è¯•</h3><p>å¯ä»¥å…ˆåˆ°ç›®å½•ä¸‹ï¼Œè¿è¡Œä¸€ä¸‹ç¼–è¯‘ï¼Œçœ‹ç¨‹åºæ˜¯å¦å†™å¯¹äº†ï¼Œå¦‚æœç¼–è¯‘æŠ¥é”™ï¼Œå¯èƒ½æ˜¯å“ªé‡Œå¤åˆ¶æ¼äº†ã€‚ç”±äº Rust è¯­è¨€çš„ç¼–è¯‘å™¨éå¸¸ä¸¥æ ¼ï¼Œæ‰€ä»¥å³ä½¿æ²¡æœ‰é”™è¯¯ï¼Œä¹Ÿä¼šæœ‰å¾ˆå¤š warningï¼Œæš‚æ—¶ä¸ç”¨ç®¡é‚£äº›è­¦å‘Šä¿¡æ¯ï¼š</p>
<pre><code class="bash">anchor build  
</code></pre>
<p>æ¥ä¸‹æ¥åˆ° <code>usdt_clone/tests/usdt_clone.ts</code> æ–‡ä»¶ï¼Œå¤åˆ¶è¿™äº›ä»£ç è¿›å»ï¼š</p>
<pre><code class="ts">import anchor from &quot;@coral-xyz/anchor&quot;;
import &#123; Program &#125; from &quot;@coral-xyz/anchor&quot;;
import &#123; SystemProgram, Keypair &#125; from &quot;@solana/web3.js&quot;;
import &#123; assert &#125; from &quot;chai&quot;;

const &#123; AnchorProvider, BN &#125; = anchor;

describe(&quot;usdt_clone / init_mint&quot;, () =&gt; &#123;
  const provider = AnchorProvider.env();
  anchor.setProvider(provider);
  const program = anchor.workspace.UsdtClone as Program;

  const mintKey = Keypair.generate();

  it(&quot;creates a Mint with correct metadata&quot;, async () =&gt; &#123;
    const txSig = await program.methods
      .initMint(new BN(6))
      .accounts(&#123;
        mint: mintKey.publicKey,
        authority: provider.wallet.publicKey,
        systemProgram: SystemProgram.programId,
      &#125;)
      .signers([mintKey])
      .rpc();

    console.log(&quot;tx:&quot;, txSig);

    const mintAccount = await program.account.mint.fetch(mintKey.publicKey);

    assert.equal(mintAccount.decimals, 6);
    assert.equal(
      mintAccount.mintAuthority.toBase58(),
      provider.wallet.publicKey.toBase58()
    );
  &#125;);
&#125;);
</code></pre>
<p>è¿™æ®µä»£ç ä½¿ç”¨æœ¬åœ°çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œæ„é€ äº†ä¸€äº›å‚æ•°å»è°ƒç”¨æˆ‘ä»¬åœ¨åˆçº¦é‡Œå†™çš„ <code>initMint</code> æ–¹æ³•ï¼Œæ¯”å¦‚æŒ‡å®šç²¾åº¦ä¸º 6 ä½ï¼Œä¼ é€’äº† <code>InitMint</code> ç»“æ„ä½“éœ€è¦çš„ 3 ä¸ªå‚æ•°ç­‰ã€‚æ¨¡æ‹Ÿäº¤æ˜“çš„æ‰§è¡Œç»“æœèµ‹å€¼ç»™äº† <code>txSig</code> å˜é‡ï¼Œå¯ä»¥åœ¨è¾“å‡ºæ—¥å¿—ä¸­çœ‹åˆ°äº¤æ˜“å“ˆå¸Œã€‚å¹¶ä¸”åœ¨äº¤æ˜“ç»“æŸåï¼Œç”¨è¯­å¥ <code>program.account.mint.fetch</code> æŸ¥è¯¢äº†åˆçº¦çš„ <code>mint</code> å±æ€§çš„å€¼ï¼Œå®ƒçš„ç²¾åº¦åº”è¯¥ç­‰äºæˆ‘ä»¬çš„å‚æ•°ï¼Œauthority ä¹Ÿåº”è¯¥æ˜¯æˆ‘ä»¬æœ¬åœ°å‘èµ·æ¨¡æ‹Ÿäº¤æ˜“çš„è´¦æˆ·åœ°å€ã€‚</p>
<p>è¿è¡Œè¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹å•å…ƒæµ‹è¯•çš„æ•ˆæœï¼š</p>
<pre><code class="bash">anchor test
</code></pre>
<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä¼šçœ‹åˆ° <code>1 passing (460ms)</code> çš„å­—æ ·ã€‚</p>
<h3 id="8-å¼€æˆ·å’Œè½¬è´¦"><a href="#8-å¼€æˆ·å’Œè½¬è´¦" class="headerlink" title="8. å¼€æˆ·å’Œè½¬è´¦"></a>8. å¼€æˆ·å’Œè½¬è´¦</h3><p>åŸºäºä¸Šé¢æˆ‘ä»¬å·²ç»çœ‹æ‡‚çš„è¯­æ³•è§„åˆ™ï¼Œå¯ä»¥ç»§ç»­åœ¨åˆçº¦ä»£ç ä¸­æ–°å¢è¿™æ ·ä¸¤ä¸ªè´¦æˆ·ç»“æ„çš„å®šä¹‰ï¼Œåˆ†åˆ«ç”¨æ¥å¼€æˆ·å’Œè½¬è´¦ã€‚è¿™é‡Œçš„ <code>#[error_code]</code> æ˜¯æ–°å‡ºç°çš„å®ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œç”¨äºç¨‹åºæŠ¥é”™çš„æ—¶å€™è°ƒç”¨ï¼š</p>
<pre><code class="rust">#[derive(Accounts)]
pub struct InitTokenAccount&lt;&#39;info&gt; &#123;
    #[account(init, payer = owner, space = 8 + 32 + 8)]
    pub token: Account&lt;&#39;info, TokenAccount&gt;,
    #[account(mut, signer)]
    pub owner: Signer&lt;&#39;info&gt;,
    pub system_program: Program&lt;&#39;info, System&gt;,
&#125;

#[derive(Accounts)]
pub struct Transfer&lt;&#39;info&gt; &#123;
    #[account(mut, has_one = owner)]
    pub from: Account&lt;&#39;info, TokenAccount&gt;,
    #[account(mut)]
    pub to: Account&lt;&#39;info, TokenAccount&gt;,
    #[account(signer)]
    pub owner: Signer&lt;&#39;info&gt;,
&#125;

#[error_code]
pub enum ErrorCode &#123;
    InsufficientFunds,
    ArithmeticOverflow,
&#125;
</code></pre>
<p>ç„¶åæ–°å¢ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ‰§è¡Œå¼€æˆ·çš„é€»è¾‘ä»¥åŠè½¬è´¦çš„é€»è¾‘ã€‚æ³¨æ„è¿™é‡Œå¼€æˆ·çš„æ—¶å€™ï¼Œ<code>token.balance = 1000</code> æ„å‘³ç€æ¯ä¸€ä¸ªå¼€æˆ·çš„åœ°å€ï¼Œé»˜è®¤éƒ½ä¼šæœ‰ 1000 çš„ä½™é¢ã€‚è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–æµç¨‹å’Œä»£ç ã€æ–¹ä¾¿å•å…ƒæµ‹è¯•ï¼Œè¿™ä¸ªæ•°å­—å¯ä»¥éšæ„æ”¹åŠ¨ï¼š</p>
<pre><code class="Rust">pub fn init_token_account(ctx: Context&lt;InitTokenAccount&gt;) -&gt; Result&lt;()&gt; &#123;
  let token = &amp;mut ctx.accounts.token;
  token.owner = ctx.accounts.owner.key();
  token.balance = 1000;
  Ok(())
&#125;

pub fn transfer(ctx: Context&lt;Transfer&gt;, amount: u64) -&gt; Result&lt;()&gt; &#123;
  let from = &amp;mut ctx.accounts.from;
  let to   = &amp;mut ctx.accounts.to;

  require!(from.balance &gt;= amount, ErrorCode::InsufficientFunds);

  from.balance -= amount;
  to.balance = to
      .balance
      .checked_add(amount)
      .ok_or(ErrorCode::ArithmeticOverflow)?;

  Ok(())
&#125;
</code></pre>
<p>è¿™æ˜¯é’ˆå¯¹å¼€æˆ·å’Œè½¬è´¦åŠŸèƒ½çš„å•å…ƒæµ‹è¯•ä»£ç ï¼š</p>
<pre><code class="ts">const tokenA = Keypair.generate();
const tokenB = Keypair.generate();

it(&quot;initializes tokenA &amp; tokenB, each with balance 1000&quot;, async () =&gt; &#123;
  for (const tok of [tokenA, tokenB]) &#123;
    await program.methods
      .initTokenAccount()
      .accounts(&#123;
        token: tok.publicKey,
        owner: provider.wallet.publicKey,
        systemProgram: SystemProgram.programId,
      &#125;)
      .signers([tok])
      .rpc();

    const acc = await program.account.tokenAccount.fetch(tok.publicKey);
    assert.equal(
      acc.owner.toBase58(),
      provider.wallet.publicKey.toBase58()
    );
    assert.equal(acc.balance.toNumber(), 1000);
  &#125;
&#125;);

it(&quot;transfers 250 from A to B (balances 750 / 1250)&quot;, async () =&gt; &#123;
  await program.methods
    .transfer(new BN(250))
    .accounts(&#123;
      from:  tokenA.publicKey,
      to:    tokenB.publicKey,
      owner: provider.wallet.publicKey,
    &#125;)
    .rpc();

  const a = await program.account.tokenAccount.fetch(tokenA.publicKey);
  const b = await program.account.tokenAccount.fetch(tokenB.publicKey);

  assert.equal(a.balance.toNumber(), 750);
  assert.equal(b.balance.toNumber(), 1250);
&#125;);
</code></pre>
<p>å¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥è¯•ç€æŠŠè¿™ä¸ªåˆçº¦ä¹Ÿéƒ¨ç½²åˆ° devnet ä¸Šï¼Œç„¶åé€šè¿‡ SDK æ¥å‘èµ·å¯¹é“¾ä¸Šåˆçº¦çš„è°ƒç”¨ã€‚</p>
<p><br><br></p>
<h2 id="å¼€å‘æ•™ç¨‹-3"><a href="#å¼€å‘æ•™ç¨‹-3" class="headerlink" title="å¼€å‘æ•™ç¨‹-3"></a>å¼€å‘æ•™ç¨‹-3</h2><p>ä½ ä¹Ÿè®¸æ³¨æ„åˆ°ï¼Œåœ¨ç¼–å†™æ™ºèƒ½åˆçº¦çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºç¨‹åºé€»è¾‘çš„æè¿°åè€Œæ˜¯è½»é‡çš„ï¼Œæ¯”è¾ƒå¤æ‚çš„éƒ¨åˆ†æ˜¯ä¸åŒç±»å‹çš„ <code>#[account]</code> å®ï¼Œä»¥åŠå»äº†è§£å®æ¥å—çš„å‚æ•°ï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»ºè´¦æˆ·ã€å¦‚æœåˆ›å»ºåº”è¯¥ç§Ÿç”¨å¤šå°‘ä¸ªå­—èŠ‚çš„ç©ºé—´ç­‰ï¼Œå› ä¸º Solana çš„å…¨éƒ¨è´¦æˆ·æ•°æ®éœ€è¦åŠ è½½åˆ°èŠ‚ç‚¹æœåŠ¡å™¨çš„å†…å­˜ä¸­ï¼Œä»·æ ¼æ¯”è¾ƒæ˜‚è´µï¼Œæ‰€ä»¥è¦æ±‚å¼€å‘è€…å¯¹äºç©ºé—´çš„å ç”¨è®¡ç®—æ¯”è¾ƒç²¾ç»†ã€‚è€Œ Solana çš„è´¦æˆ·ä½“ç³»åˆæœ‰ç‚¹å¤æ‚ï¼Œéœ€è¦ç¨å¾®ç†è§£ä¸€ä¸‹ã€‚</p>
<h3 id="1-å‘½ä»¤è¡Œå·¥å…·å‘è¡Œä»£å¸"><a href="#1-å‘½ä»¤è¡Œå·¥å…·å‘è¡Œä»£å¸" class="headerlink" title="1. å‘½ä»¤è¡Œå·¥å…·å‘è¡Œä»£å¸"></a>1. å‘½ä»¤è¡Œå·¥å…·å‘è¡Œä»£å¸</h3><p>å¯¹äºå‘è¡Œ USDT è¿™ç§ç»å…¸åœºæ™¯ï¼ŒSolana å·²ç»å°è£…å¥½äº†æ™ºèƒ½åˆçº¦çš„åº“å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œç”šè‡³å°è£…å¥½äº†å‘½ä»¤è¡Œå·¥å…·ï¼Œåªéœ€è¦ç®€å•çš„æ“ä½œï¼Œä¸éœ€è¦å†™åˆçº¦ï¼Œå°±å¯ä»¥å‘è¡Œä»£å¸ã€‚Solana æŠŠè¿™äº›ä»£å¸ç»Ÿç§°ä¸º SPL Tokenã€‚åˆ›å»ºä¸€ä¸ª 6 ä½ç²¾åº¦çš„ SPL Token çš„å‘½ä»¤æ˜¯è¿™æ ·ï¼Œæ³¨æ„ä¸éœ€è¦å†™ä»£å¸åå­—ï¼š</p>
<pre><code class="bash">spl-token create-token --decimals 6
</code></pre>
<p>å‘½ä»¤è¡Œè¿è¡Œç»“æŸåï¼Œä¼šè¾“å‡ºä¸€ä¸ª <code>Address</code>ï¼Œè¿™ä¸ªå°±æ˜¯ SPL Token çš„ä»£å¸åœ°å€ï¼Œæ¯”å¦‚æˆ‘å¾—åˆ°çš„åœ°å€æ˜¯ <code>E75GMXAfJ91XuRboSpjwkDmta45Etgt3F3Gf5WLZvLbV</code>ï¼Œå¯ä»¥åœ¨ <a href="https://explorer.solana.com/address/E75GMXAfJ91XuRboSpjwkDmta45Etgt3F3Gf5WLZvLbV?cluster=devnet">åŒºå—é“¾æµè§ˆå™¨</a> ä¸ŠæŸ¥åˆ°ã€‚</p>
<p>æ¥ä¸‹æ¥éœ€è¦ä¸€ä¸ªæ“ä½œï¼Œæ¥ç»™ä½ æœ¬åœ°çš„è´¦æˆ·ï¼Œåœ¨è¿™ä¸ª USDT ä»£å¸ä¸Šåˆ›å»ºä¸€ä¸ªå…³è”è´¦æˆ·ï¼ˆAssociated Token Accountï¼ŒATAï¼‰ã€‚è¿™ä¸ªåˆ›å»ºå…³è”è´¦æˆ·çš„åŠ¨ä½œï¼Œç›¸å½“äºåœ¨åˆçº¦ä¸Šå®ä¾‹åŒ–ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„é‡Œä¿å­˜äº†ä½ çš„ USDT ä½™é¢ç­‰ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ•°æ®ï¼ŒUSDT ä»£å¸çš„åˆçº¦ä¸Šå°±æ‰¾ä¸åˆ°ä½ ã€‚</p>
<p>ç”¨ â€œè´¦æˆ·â€ è¿™ä¸ªè¯å¯èƒ½æœ‰ç‚¹è¿·æƒ‘ï¼Œæˆ‘æœ¬åœ°å·²ç»æœ‰è´¦æˆ·äº†ï¼Œè¿˜èƒ½ç”¨ <code>solana address</code> å‘½ä»¤çœ‹åˆ°è´¦æˆ·åœ°å€ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ä¸“é—¨è°ƒç”¨ USDT çš„åˆçº¦ï¼Œåˆ›å»ºä»€ä¹ˆ ATA è´¦æˆ·ï¼Ÿå¯ä»¥ç†è§£ä¸ºï¼Œåˆçº¦é‡Œæœ¬æ¥æœ‰ä¸ªç©ºçš„ map{}ï¼Œåˆ›å»º ATA è´¦æˆ·å°±æ˜¯å‘ map é‡Œæ’å…¥äº†ä¸€æ¡æ•°æ®ï¼Œkey æ˜¯ä½ æœ¬åœ°çš„è´¦æˆ·åœ°å€ï¼Œvalue æ˜¯ USDT çš„ä½™é¢ä¿¡æ¯ã€‚å¦‚æœ map é‡Œæ²¡æœ‰ä½ çš„ä¿¡æ¯ï¼Œä½ ç”šè‡³ä¸èƒ½æ¥å— USDT çš„è½¬è´¦ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆ Solana è¦è¿™ä¹ˆè®¾è®¡ï¼Œå¿…é¡»å…ˆåœ¨ map é‡Œå¼€è¾Ÿç©ºé—´ï¼Œæ‰èƒ½æ¥å—è½¬è´¦å‘¢ï¼Ÿå› ä¸ºä¸€å¼€å§‹æœ‰æåˆ°è¿‡ï¼Œå¯¹äº Solana æ¥è¯´ï¼Œé“¾ä¸Šç©ºé—´æ˜¯æ¯”è¾ƒçè´µçš„ï¼Œmap é‡Œå¼€è¾Ÿä¸€ä¸ªé”®å€¼å¯¹çš„ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯åˆ›å»º ATA è´¦æˆ·ï¼Œéœ€è¦å ç”¨ 165 ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œè¿™ 165 å­—èŠ‚ä¸æ˜¯å…è´¹ä½¿ç”¨çš„ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>solana rent 165</code> æ¥è®¡ç®—å­—èŠ‚æ•°å¯¹åº”çš„è´¹ç”¨ï¼Œæ¯”å¦‚è¿™é‡Œå°±ä¼šè¾“å‡º <code>0.00203928 SOL</code>ï¼Œä¹Ÿå°±æ˜¯ä½ åˆ›å»º ATA è´¦æˆ·çš„äº¤æ˜“ï¼Œåœ¨æ‰‹ç»­è´¹ä¹‹å¤–ï¼Œä¼šå¤šæ”¯ä»˜è¿™ä¹ˆäº›ç§Ÿé‡‘ã€‚æ‰€ä»¥å¿…é¡»è¦æœ‰åˆ›å»º ATA è´¦æˆ·è¿™ä¸ªæ“ä½œï¼Œä¸»è¦æ˜¯ä¸ºäº†æ”¶è´¹ã€‚</p>
<p>å›åˆ°æˆ‘ä»¬çš„æ“ä½œï¼Œåˆ›å»º ATA è´¦æˆ·çš„å‘½ä»¤æ˜¯ï¼š</p>
<pre><code class="bash">spl-token create-account E75GMXAfJ91XuRboSpjwkDmta45Etgt3F3Gf5WLZvLbV
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šæ˜¾ç¤º <code>Creating account</code>ï¼Œåé¢æ˜¯ä½ çš„ ATA åœ°å€ï¼Œæ¯”å¦‚æˆ‘çš„æ˜¯ <code>E5XmcEJhhGUri8itThLGk8QfPzY1acFid8JmVyo5DWUo</code>,åŒæ ·çš„ï¼Œå¯ä»¥åœ¨ <a href="https://explorer.solana.com/address/E5XmcEJhhGUri8itThLGk8QfPzY1acFid8JmVyo5DWUo?cluster=devnet">åŒºå—é“¾æµè§ˆå™¨</a> ä¸­çœ‹å¾—åˆ°ã€‚</p>
<p>å¯¹è¦æ³¨æ„ï¼ŒATA è´¦æˆ·æ˜¯æœ‰å•ç‹¬çš„åœ°å€çš„ï¼Œæ¯”å¦‚ä½ æœ¬åœ°çš„è´¦æˆ·åœ°å€æ˜¯ <code>a</code>ï¼Œåœ¨ USDT ä»£å¸ä¸Šåˆ›å»ºçš„ ADA è´¦æˆ·åœ°å€å°†æ˜¯ <code>b</code>ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚è€Œåç»­æ¥å— USDTã€å‘é€ USDTï¼Œå°†å…¨éƒ¨é€šè¿‡ ATA è´¦æˆ·æ¥è¿›è¡Œï¼Œè€Œä¸æ˜¯ä½ æœ¬åœ°çš„é‚£ä¸ªè´¦æˆ·ã€‚SPL Token æä¾›äº†å‘½ä»¤æ¥æŸ¥çœ‹æœ¬åœ°é’±åŒ…è´¦æˆ·å’Œ ATA è´¦æˆ·çš„å…³ç³»ï¼š</p>
<pre><code class="bash">spl-token address --verbose --token E75GMXAfJ91XuRboSpjwkDmta45Etgt3F3Gf5WLZvLbV

// è¾“å‡ºæ˜¯è¿™ä¸ªæ ·å­
Wallet address: 75sFifxBt7zw1YrDfCdPjDCGDyKEqLWrBarPCLg6PHwb
Associated token address: E5XmcEJhhGUri8itThLGk8QfPzY1acFid8JmVyo5DWUo
</code></pre>
<p>é‚£ä¹ˆç°åœ¨ï¼Œå¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œæ¥æŸ¥è¯¢ USDT çš„ä½™é¢ï¼Œ<code>balance</code> åé¢çš„å‚æ•°æ˜¯æŒ‡ä»£å¸åœ°å€ï¼Œè€Œä¸æ˜¯ ATA åœ°å€ï¼š</p>
<pre><code class="bash">spl-token balance E75GMXAfJ91XuRboSpjwkDmta45Etgt3F3Gf5WLZvLbV 
</code></pre>
<p>å½“ç„¶é»˜è®¤æ˜¯ 0ï¼Œç°åœ¨ç»™è¿™ä¸ªåœ°å€æŒ–ä¸€äº› USDT ä¸Šå»ã€‚è¿™ä¸ªå‘½ä»¤æœ‰ç‚¹é•¿ï¼Œæœ‰ 3 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»£å¸åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»£å¸æ•°é‡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ ATA åœ°å€ï¼Œæ„å‘³ç€è¦æŒ–å“ªä¸ªä»£å¸ã€æŒ–å¤šå°‘ã€æŒ–ç»™è°ï¼š</p>
<pre><code class="bash">spl-token mint E75GMXAfJ91XuRboSpjwkDmta45Etgt3F3Gf5WLZvLbV 5 E5XmcEJhhGUri8itThLGk8QfPzY1acFid8JmVyo5DWUo
</code></pre>
<p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œå°±å¯ä»¥æŸ¥è¯¢åˆ°ä½™é¢ï¼Œä¹Ÿèƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸Šçœ‹åˆ°ä½™é¢äº†ï¼Œç±»ä¼¼çš„ï¼Œè½¬è´¦ USDT çš„å‘½ä»¤æ˜¯ï¼š</p>
<pre><code class="bash">spl-token transfer &lt;MINT&gt; 1 &lt;ATA&gt;
</code></pre>
<p>Solana ä¸ºäº†é¿å…ç”¨æˆ·ä¸è®°å¾—è‡ªå·±çš„ ATA è´¦æˆ·åœ°å€ï¼Œä¹Ÿæä¾›äº†äººæ€§åŒ–çš„å‘½ä»¤ï¼Œæœ€åä¸€ä¸ªå‚æ•°å¯ä»¥ç›´æ¥ç”¨æœ¬åœ°çš„é’±åŒ…åœ°å€ï¼Œè€Œä¸éœ€è¦ ATA åœ°å€ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨ Solana çš„é’±åŒ…ï¼Œå¹¶æ²¡æœ‰æ„Ÿè§‰åˆ° ATA è´¦æˆ·è¿™ç§ä¸œè¥¿å­˜åœ¨çš„åŸå› ï¼š</p>
<pre><code class="bash">spl-token transfer &lt;MINT&gt; 1 &lt;RECIPIENT_WALLET&gt;
</code></pre>
<h3 id="2-ç”¨-spl-æ ‡å‡†åº“å†™æ™ºèƒ½åˆçº¦"><a href="#2-ç”¨-spl-æ ‡å‡†åº“å†™æ™ºèƒ½åˆçº¦" class="headerlink" title="2. ç”¨ spl æ ‡å‡†åº“å†™æ™ºèƒ½åˆçº¦"></a>2. ç”¨ spl æ ‡å‡†åº“å†™æ™ºèƒ½åˆçº¦</h3><p>æˆ‘ä»¬å°è¯•ä¸€ä¸‹åœ¨æ™ºèƒ½åˆçº¦é‡Œè°ƒç”¨ spl åº“å‡½æ•°ï¼Œè¿™ç§å®˜æ–¹æä¾›çš„ã€ç³»ç»Ÿçº§åˆ«çš„åº“å‡½æ•°æ˜¯ç»è¿‡ä¸¥æ ¼å®‰å…¨å®¡è®¡çš„ï¼Œæ¯”æˆ‘ä»¬è‡ªå·±å†™è¦å®‰å…¨ï¼Œæ‰€ä»¥æœ‰äº†è¿™äº›åº“å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ å…³æ³¨è‡ªå·±å®šåˆ¶åŒ–çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦å…³å¿ƒå¤ªåº•å±‚çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ USDT ä½™é¢è®¡ç®—æ˜¯å¦ç²¾åº¦æœ‰æŸå¤±ä¹‹ç±»çš„é—®é¢˜ã€‚å…ˆåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼š</p>
<pre><code class="bash">anchor init usdt_spl
</code></pre>
<p>å¯¼å…¥ <code>anchor-spl</code> ä¾èµ–ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥æŠŠæœ€æ–°ç‰ˆæœ¬çš„åº“å‡½æ•°å¯¼å…¥è¿›æ¥ï¼Œå‘½ä»¤è¿è¡Œåï¼Œå¯ä»¥åœ¨ <code>programs/usdt_spl/Cargo.toml</code> æ–‡ä»¶çš„ <code>[dependencies]</code> éƒ¨åˆ†ï¼Œæ–°å¢äº†è¿™æ ·ä¸€è¡Œ <code>anchor-spl = &quot;0.31.1&quot;</code>ï¼Œè¯´æ˜æ˜¯æˆåŠŸçš„ï¼š</p>
<pre><code class="bash">cargo add anchor-spl
</code></pre>
<p>å¼€å§‹å†™åˆçº¦ä»£ç ç¨‹åºã€‚å…ˆåœ¨æœ€å¼€å§‹ä¸¤è¡Œå¯¼å…¥ spl çš„ä¾èµ–ã€‚æˆ‘ä»¬ä¹‹å‰æœ‰ä½¿ç”¨è¿‡ Anchor æ¡†æ¶è‡ªå¸¦çš„è´¦æˆ·ç±»å‹å¦‚ <code>Account</code> å’Œ <code>Signer</code>ï¼Œé‚£ä¹ˆè¿™é‡Œ spl ä¹Ÿæ˜¯æä¾›äº†å¤šç§æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ <code>TokenAccount</code> å°±è¡¨ç¤º ATA è´¦æˆ·çš„æ•°æ®ç»“æ„ï¼š</p>
<pre><code class="rust">use anchor_spl::token::&#123;self, MintTo, Token, TokenAccount, Mint&#125;;
</code></pre>
<p>æ¥ç€å®šä¹‰ mint è¡Œä¸ºç›¸å…³çš„è´¦æˆ·è§„åˆ™ï¼š</p>
<pre><code class="rust">#[derive(Accounts)]
pub struct MintToCtx&lt;&#39;info&gt; &#123;
    #[account(mut)]
    pub mint: Account&lt;&#39;info, Mint&gt;, 

    #[account(mut)]
    pub to:   Account&lt;&#39;info, TokenAccount&gt;,

    #[account(mut)]
    pub authority: Signer&lt;&#39;info&gt;,

    pub token_program: Program&lt;&#39;info, Token&gt;,
&#125;
</code></pre>
<p>è¿™å‡ è¡Œä»£ç ä¸­ï¼Œ<code>mut</code> å…³é”®è¯æˆ‘ä»¬ä¹‹å‰ç”¨åˆ°è¿‡ï¼Œè¡¨æ˜è´¦æˆ·æ•°æ®è¦å…è®¸è¢«å†™å…¥ã€‚<code>Account</code> ç±»å‹æ˜¯ anchor æ¡†æ¶è‡ªå¸¦çš„ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨è¿‡ã€‚<code>Mint</code> ç±»å‹åˆ™æ˜¯æ–°å‡ºç°çš„ï¼Œæ˜¯ä» spl æ¡†æ¶é‡Œå¯¼å…¥çš„ï¼Œæˆ‘ä»¬ä¹‹å‰ä¸æ˜¯è‡ªå·±å®šä¹‰è¿‡ä¸€ä¸ªç”¨ <code>#[Account]</code> å®æ ‡æ³¨çš„ <code>Mint</code> ç»“æ„ä½“ï¼Œç„¶ååœ¨ <code>#[derive(Accounts)]</code> é‡Œä½¿ç”¨å—ã€‚ç°åœ¨æœ‰äº† spl åº“ï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±å®šä¹‰ <code>Mint</code> ç»“æ„ä½“çš„ç±»å‹ã€å‚æ•°ä¸ªæ•°ï¼Œç›´æ¥ä½¿ç”¨å°±å¥½ã€‚</p>
<p>åŒæ ·çš„ï¼Œ<code>TokenAccount</code> å’Œ <code>Token</code> ä¹Ÿéƒ½æ˜¯ spl æ¡†æ¶æä¾›çš„ç±»å‹ã€‚è¿™ä¹ˆçœ‹ä¼¼ä¹ä½¿ç”¨ spl æ¡†æ¶æ¯”è‡ªå·±å†™ç®€å•äº†ä¸å°‘ï¼Ÿä¸èƒ½é«˜å…´çš„å¤ªæ—©ï¼Œè¿˜æœ‰ä¸€æ®µä»£ç æ²¡æœ‰å†™ä¸Šï¼š</p>
<pre><code class="rust">impl&lt;&#39;info&gt; From&lt;&amp;MintToCtx&lt;&#39;info&gt;&gt; for CpiContext&lt;&#39;_, &#39;_, &#39;_, &#39;info, MintTo&lt;&#39;info&gt;&gt;
&#123;
    fn from(accts: &amp;MintToCtx&lt;&#39;info&gt;) -&gt; Self &#123;
        let cpi_accounts = MintTo &#123;
            mint:      accts.mint.to_account_info(),
            to:        accts.to.to_account_info(),
            authority: accts.authority.to_account_info(),
        &#125;;
        CpiContext::new(accts.token_program.to_account_info(), cpi_accounts)
    &#125;
&#125;
</code></pre>
<p>è¿™æ®µä»£ç ä¹ä¸€çœ‹çœ¼èŠ±ç¼­ä¹±ï¼Œå¯èƒ½è¦æ™•äº†ï¼Œä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šå°–æ‹¬å·ï¼Œä¸ºä»€ä¹ˆé‚£ä¹ˆå¤šå•å¼•å·å’Œä¸‹åˆ’çº¿ã€‚è¿™å°±æ˜¯ Rustï¼Œä¸ºäº†è¿åˆç‹¬ç‰¹çš„å†…å­˜ç®¡ç†è®¾è®¡ï¼Œä¸å¾—ä¸è®©è¯­è¨€åœ¨è¯­æ³•å½¢å¼ä¸Šå˜å¾—å¤æ‚ã€‚</p>
<p><code>impl ... From&lt;...&gt; for ...</code> æ˜¯ Rust çš„è¯­æ³•è§„åˆ™ï¼Œå¤§æ„æ˜¯è®©ä¸€ç§ç±»å‹å˜ä¸ºå¦ä¸€ç§ç±»å‹ï¼Œæˆ‘ä»¬è¿™é‡Œå°±æ˜¯è®© <code>From&lt;&amp;MintToCtx&lt;&#39;info&gt;&gt;</code> ç±»å‹å˜ä¸º <code>CpiContext&lt;&#39;_, &#39;_, &#39;_, &#39;info, MintTo&lt;&#39;info&gt;&gt;</code>ã€‚å…¶ä¸­ <code>MintToCtx</code> æ˜¯æˆ‘ä»¬ä¸Šé¢è‡ªå·±ç”¨ <code>#[derive(Accounts)]</code> å®å®šä¹‰çš„ç±»å‹ï¼Œç„¶åä½œä¸ºæ³›å‹å‚æ•°ä¼ é€’ç»™äº† <code>From</code>ï¼Œè€Œè¿™ä¸ª <code>From</code>ï¼Œæ˜¯ Rust æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ªåŒ…è£…ç±»å‹ï¼Œç”¨æ¥æ¥å—æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚</p>
<p>è‡³äºåé¢çš„ <code>CpiContext</code> éƒ¨åˆ†ï¼ŒCpi çš„å…¨ç§°æ˜¯è·¨ç¨‹åºè°ƒç”¨ Cross-Program Invocationï¼Œç”¨äºæŠŠè¦è°ƒç”¨çš„å¤–éƒ¨ç¨‹åºï¼Œä»¥åŠè´¦æˆ·ç±»å‹ï¼Œéƒ½æ‰“åŒ…åˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®ç»“æ„ä¸­ã€‚å‰ä¸‰ä¸ªå‚æ•°ä¸ç”¨ç®¡ï¼Œæœ€åçš„ <code>MintTo</code> æ˜¯æˆ‘ä»¬çœŸæ­£ä¼ å…¥çš„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹æ˜¯ spl åº“æä¾›çš„ã€‚</p>
<p>é‚£ä¹ˆä¹Ÿè®¸è¿™é‡Œæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¿˜æ¶‰åŠåˆ°è°ƒç”¨å¤–éƒ¨ç¨‹åºï¼ŸCpiContext åˆæ˜¯å¦‚ä½•çŸ¥é“è¦è°ƒç”¨å“ªä¸ªå¤–éƒ¨ç¨‹åºçš„ï¼Ÿè¿™ä¸ªå’Œ Solana æ™ºèƒ½åˆçº¦çš„è®¾è®¡æœ‰å…³ï¼ŒSPL Token ä¸æ­¢æ˜¯ä¸€äº›ç±»å‹å®šä¹‰ï¼Œè€Œä¸”æ˜¯å®é™…å·²ç»éƒ¨ç½²åœ¨ Solana ç½‘ç»œä¸Šçš„ç¨‹åºã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨ spl ä¾èµ–åº“çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯å»è°ƒç”¨é‚£äº›å·²ç»é¢„å…ˆåœ¨ Solana ç½‘ç»œä¸Šéƒ¨ç½²çš„ spl åˆçº¦ã€‚æ™ºèƒ½åˆçº¦åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå‘ç°ä½ è¦è°ƒç”¨ splï¼Œå°±å»æ‰¾ spl çš„åˆçº¦åœ°å€ï¼Œæ‰§è¡Œä¸€äº›æ“ä½œï¼Œç„¶åè¿”å›ç»“æœã€‚ç›¸å½“äºæ•´ä¸ªç½‘ç»œä¸Šçš„æ™ºèƒ½åˆçº¦éƒ½åœ¨å¤ç”¨åŒä¸€å¥— spl åˆçº¦ã€‚</p>
<p>æ‰€ä»¥è¦ç•™æ„ Solana æ™ºèƒ½åˆçº¦ä¾èµ–åº“çš„å®ç°æ–¹å¼ï¼Œå’Œå…¶ä»–ç½‘ç»œæ˜¯æœ‰ä¸åŒçš„ã€‚Solana åœ¨è®¾è®¡ä¸Šè®©ç¨‹åºå’Œæ•°æ®åˆ†ç¦»ï¼Œä»¥è‡´äºå¯ä»¥å®ç°ç¨‹åºå…±äº«çš„æ¨¡å¼ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸è‡ªå·±éƒ¨ç½²ä¸€å¥— spl åˆçº¦ï¼Œæˆ–è€…æ¯ä¸ªäººéƒ½å„è‡ªéƒ¨ç½²ä¸€å¥— spl åˆçº¦ï¼Œç„¶åè‡ªå·±ä½¿ç”¨å‘¢ï¼Ÿä¸€æ–¹é¢æ˜¯éœ€è¦ä»˜å‡ºé¢å¤–çš„æ‰‹ç»­è´¹æˆæœ¬ï¼Œå¦ä¸€æ–¹é¢æ˜¯ Solana çš„æ™ºèƒ½åˆçº¦æœ¬æ¥å°±å…è®¸ç¨‹åºå…±äº«ï¼Œä½ è¦æ˜¯è‡ªå·±éƒ¨ç½²ä¸€å¥—ï¼Œç”¨æˆ·éƒ½ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å·å·ä¿®æ”¹æ ‡å‡†åº“çš„ä»£ç ï¼Œåè€Œä¸å®‰å…¨äº†ã€‚</p>
<p>è¿˜æœ‰æœ€åä¸€éƒ¨åˆ† <code>#[program]</code> é‡Œçš„ç¨‹åºé€»è¾‘è¦è¡¥é½ï¼š</p>
<pre><code class="rust">pub fn mint_to(ctx: Context&lt;MintToCtx&gt;, amount: u64) -&gt; Result&lt;()&gt; &#123;
    token::mint_to((&amp;*ctx.accounts).into(), amount)
&#125;
</code></pre>
<h3 id="3-ç¼–è¯‘åˆçº¦"><a href="#3-ç¼–è¯‘åˆçº¦" class="headerlink" title="3. ç¼–è¯‘åˆçº¦"></a>3. ç¼–è¯‘åˆçº¦</h3><p>ç°åœ¨ä»£ç æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœç°åœ¨ç¼–è¯‘åˆçº¦é¡¹ç›®ï¼Œä¼šé‡åˆ°æŠ¥é”™ã€‚éœ€è¦ä¿®æ”¹ä¸‹ <code>programs/usdt_spl/Cargo.toml</code> æ–‡ä»¶ï¼ŒæŠŠè¿™ä¸¤è¡Œçš„ç‰¹æ€§æ‰“å¼€ï¼š</p>
<pre><code class="rust">[features]
idl-build = [&quot;anchor-lang/idl-build&quot;, &quot;anchor-spl/idl-build&quot;]

[dependencies]
anchor-spl  = &#123; version = &quot;0.31.1&quot;, features = [&quot;token&quot;, &quot;idl-build&quot;] &#125;
</code></pre>
<p>å› ä¸ºé™æ€ç¼–è¯‘çš„æ—¶å€™ï¼Œå‘½ä»¤è¡Œé»˜è®¤æ²¡æœ‰æŠŠ spl æ ‡å‡†åº“ç»™å¸¦ä¸Šï¼Œåœ¨é…ç½®æ–‡ä»¶é‡ŒæŒ‡æ˜å°±å¯ä»¥äº†ã€‚ç°åœ¨é¡¹ç›®å¯ä»¥ç¼–è¯‘æˆåŠŸï¼š</p>
<pre><code class="bash">anchor build
</code></pre>
<h3 id="4-å†™å•å…ƒæµ‹è¯•"><a href="#4-å†™å•å…ƒæµ‹è¯•" class="headerlink" title="4. å†™å•å…ƒæµ‹è¯•"></a>4. å†™å•å…ƒæµ‹è¯•</h3><p>å®‰è£… spl ç›¸å…³çš„ nodejs ä¾èµ–ï¼Œæ³¨æ„å•å…ƒæµ‹è¯•ç”¨çš„æ˜¯ ts è¯­è¨€ï¼Œä¸æ˜¯ Rust è¯­è¨€ï¼š</p>
<pre><code class="bash">npm i @coral-xyz/anchor@^0.31 @solana/spl-token chai
</code></pre>
<p>æŠŠå•å…ƒæµ‹è¯•ä»£ç å¤åˆ¶åˆ° <code>tests/usdt_spl.ts</code> æ–‡ä»¶ä¸­ï¼š</p>
<pre><code class="ts">import anchor from &quot;@coral-xyz/anchor&quot;;
import &#123; Program &#125; from &quot;@coral-xyz/anchor&quot;;
import &#123;
  createMint,
  createAssociatedTokenAccount,
  getAccount,
  TOKEN_PROGRAM_ID,
&#125; from &quot;@solana/spl-token&quot;;
import &#123; assert &#125; from &quot;chai&quot;;

const &#123; AnchorProvider, BN &#125; = anchor;

describe(&quot;usdt_spl / mint_to&quot;, () =&gt; &#123;
  const provider = AnchorProvider.env();
  anchor.setProvider(provider);
  const program = anchor.workspace.UsdtSpl as Program;

  let mintPubkey: anchor.web3.PublicKey;
  let ata: anchor.web3.PublicKey;

  it(&quot;creates mint, mints 1 USDT into ATA&quot;, async () =&gt; &#123;
    mintPubkey = await createMint(
      provider.connection,
      provider.wallet.payer,          // fee-payer
      provider.wallet.publicKey,      // mint authority
      null,                           // freeze authority
      6                               // decimals
    );

    ata = await createAssociatedTokenAccount(
      provider.connection,
      provider.wallet.payer,          // fee-payer
      mintPubkey,
      provider.wallet.publicKey       // owner
    );

    await program.methods
      .mintTo(new BN(1_000_000))      // 1 USDT
      .accounts(&#123;
        mint: mintPubkey,
        to: ata,
        authority: provider.wallet.publicKey,
        tokenProgram: TOKEN_PROGRAM_ID,
      &#125;)
      .rpc();

    const accInfo = await getAccount(provider.connection, ata);
    assert.equal(accInfo.amount.toString(), &quot;1000000&quot;);
  &#125;);
&#125;);
</code></pre>
<p>è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œä¼šçœ‹åˆ°æˆåŠŸçš„è¾“å‡ºï¼š</p>
<pre><code class="bash">anchor test
</code></pre>
<h3 id="5-éƒ¨ç½²åˆçº¦åˆ°-devnet"><a href="#5-éƒ¨ç½²åˆçº¦åˆ°-devnet" class="headerlink" title="5. éƒ¨ç½²åˆçº¦åˆ° devnet"></a>5. éƒ¨ç½²åˆçº¦åˆ° devnet</h3><p>ç¡®ä¿è´¦æˆ·é‡Œä½™é¢è¶³å¤Ÿï¼Œç„¶åç”¨ anchor æ¥éƒ¨ç½²åˆçº¦ï¼š</p>
<pre><code class="bash">anchor deploy --provider.cluster devnet 
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤å¶å°”ä¼šå› ä¸ºç½‘ç»œé—®é¢˜æ‰§è¡Œå¤±è´¥ï¼ŒæŠ›å‡º <code>Operation timed out</code> é”™è¯¯ã€‚å¯ä»¥ç›´æ¥æŠŠ provider çš„å‚æ•°æ”¹ä¸ºè‡ªå·±çš„ rpc åœ°å€ï¼Œå¦‚æœç½‘å€æ¯”è¾ƒé•¿ï¼Œå¯ä»¥ç”¨åŒå¼•å·æ‹¬ä¸€ä¸‹ï¼š</p>
<pre><code class="bash">anchor deploy --provider.cluster &quot;&lt;your-rpc-url&gt;&quot;
</code></pre>
<p>å› ä¸ºç½‘ç»œé—®é¢˜å¸¦æ¥çš„éº»çƒ¦æœ‰å¯èƒ½è¿˜ä¸æ­¢å¦‚æ­¤ï¼Œæ¯”å¦‚æœ¬åœ°å­˜åœ¨å†™å…¥äº†ä¸€éƒ¨åˆ†ä½†æ˜¯ä¸ºå®Œæˆçš„ bufferã€é“¾ä¸Šå­˜åœ¨ buffer ä½†æ˜¯æœ¬åœ°ä¸å­˜åœ¨å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ç­‰é—®é¢˜ï¼Œä¸ºäº†ç›´æ¥è·³è¿‡é‚£äº›é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥è¿™ç§è¿™æ ·çš„å‘½ä»¤ï¼š</p>
<pre><code class="bash">solana program deploy \
  target/deploy/usdt_spl.so \
  --program-id target/deploy/usdt_spl-keypair.json \
  --url &quot;&lt;your-rpc-url&gt;&quot;
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤æ›´åŠ å¥½ç”¨ã€‚å¦‚æœæ²¡æœ‰å¸¦ <code>--program-id</code> å‚æ•°ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨æ–°ç”Ÿæˆ keypairï¼Œä¹Ÿå°±æ„å‘³ç€ä¼šæŠŠåˆçº¦éƒ¨ç½²çš„æ–°çš„åœ°å€ï¼Œè¿™ä¸ªæ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é€‰æ‹©ã€‚éƒ¨ç½²æˆåŠŸåï¼Œå°±å¯ä»¥å» <a href="https://explorer.solana.com/address/CFXzAhGKEz7tSFdNcVeCX8HosFGYczD7rZyD4vwoWozY?cluster=devnet">åŒºå—é“¾æµè§ˆå™¨</a> ä¸ŠæŸ¥çœ‹äº†ã€‚</p>
<h3 id="6-ä½¿ç”¨-SDK-è°ƒç”¨é“¾ä¸Šåˆçº¦"><a href="#6-ä½¿ç”¨-SDK-è°ƒç”¨é“¾ä¸Šåˆçº¦" class="headerlink" title="6. ä½¿ç”¨ SDK è°ƒç”¨é“¾ä¸Šåˆçº¦"></a>6. ä½¿ç”¨ SDK è°ƒç”¨é“¾ä¸Šåˆçº¦</h3><p>æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿‡ SDKï¼Œç°åœ¨å†æ¥ä½¿ç”¨å’Œå¤ä¹ ä¸€ä¸‹ï¼Œç¼–è¾‘ <code>app/app.js</code> æ–‡ä»¶ï¼ŒæŠŠä»£ç å¤åˆ¶è¿›å»ï¼š</p>
<pre><code class="ts">// scripts/mint_to.js   (CommonJS)
const anchor = require(&quot;@coral-xyz/anchor&quot;);
const &#123;
  createMint,
  createAssociatedTokenAccount,
  getAccount,
  TOKEN_PROGRAM_ID,
&#125; = require(&quot;@solana/spl-token&quot;);
const fs   = require(&quot;fs&quot;);
const os   = require(&quot;os&quot;);
const path = require(&quot;path&quot;);
const &#123; Keypair, Connection, PublicKey &#125; = anchor.web3;

const RPC_URL = process.env.RPC_URL || &quot;https://api.devnet.solana.com&quot;;
const connection = new Connection(RPC_URL, &#123; commitment: &quot;confirmed&quot; &#125;);

const secret = Uint8Array.from(
  JSON.parse(fs.readFileSync(path.join(os.homedir(), &quot;.config/solana/id.json&quot;)))
);
const wallet = new anchor.Wallet(Keypair.fromSecretKey(secret));
const provider = new anchor.AnchorProvider(connection, wallet, &#123;
  preflightCommitment: &#39;confirmed&#39;,
&#125;);
anchor.setProvider(provider);

const idl  = JSON.parse(fs.readFileSync(path.resolve(&quot;target/idl/usdt_spl.json&quot;)));
const prog = new anchor.Program(idl, provider);

(async () =&gt; &#123;
  const mint = await createMint(connection, wallet.payer, wallet.publicKey, null, 6);
  const ata  = await createAssociatedTokenAccount(connection, wallet.payer, mint, wallet.publicKey);

  const sig = await prog.methods
    .mintTo(new anchor.BN(1_000_000))
    .accounts(&#123; mint, to: ata, authority: wallet.publicKey, tokenProgram: TOKEN_PROGRAM_ID &#125;)
    .rpc();

  console.log(&quot;tx:&quot;, sig);
  console.log(`explorer: https://explorer.solana.com/tx/$&#123;sig&#125;?cluster=devnet`);

  const bal = await getAccount(connection, ata);
  console.log(&quot;balance:&quot;, bal.amount.toString());
&#125;)();
</code></pre>
<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„è¿è¡Œç»“æœï¼š</p>
<pre><code>~/work/github/sol_contract/usdt_spl main â¯ node app/app.js
tx: 3MgHxsfnJp68mrrABvCh9iwNm6MSXp1SEvk7vDYHoW7KhTEHfVNyMWsbfbEAXTC9gLzcmWu5xbkzia8hgZrcZ18i
explorer: https://explorer.solana.com/tx/3MgHxsfnJp68mrrABvCh9iwNm6MSXp1SEvk7vDYHoW7KhTEHfVNyMWsbfbEAXTC9gLzcmWu5xbkzia8hgZrcZ18i?cluster=devnet
balance: 1000000
</code></pre>
</div></div></body><script src="/js/highlight.min.js"></script><script src="/js/main.js"></script><script src="/js/bootstrap/bootstrap.min.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5JRBZ6P1W3"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-5JRBZ6P1W3');</script></html>